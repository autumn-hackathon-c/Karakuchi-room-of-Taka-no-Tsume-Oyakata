<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>

<body>
    <!-- ナビゲーションバー仮 -->
    <nav>
        <div class="container">
            <div class="d-flex justify-content-between align-items-center py-3">
                <div class="col">
                    <a href=""><img width="100" src="image/logo.png" alt="鷹の爪親方の辛口部屋のロゴ"></a>
                </div>
                <div class="col-auto">
                    <div class="d-flex align-items-center">
                        <a class="me-3" href="{% url 'survey-create'%}">アンケート作成</a>
                        <a class="me-3" href="{% url 'survey-list'%}">アンケート一覧
                        <a class=" me-3" href="">ユーザー情報</a>
                        {% comment %} Django5から<a href="{% url 'logout' %}"> （GET）が禁止され<form method="post"> （POST）でログアウトできるようになっている {% endcomment %}
                        <form action="{% url 'logout' %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-primary">ログアウト</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- ナビゲーションバー仮 -->
    </nav>
    <div class="container">
        {% comment %}
        実装時、{% block content}{% endblock content %}外はbase.htmlから参照する
        {% endcomment %}
        {% block content %}
        <div>
            <h3>ようこそ{{ user.user_name }}さん</h3>
        </div>       
        <div class="text-center p-3">
            <a href="{% url 'survey-create'%}" class="btn btn-success btn-lg">アンケートを作成する！</a>
        </div>
        <div class="header">
            <h2>アンケート一覧</h2>
        </div>
        <div class="search-bar w-100 mx-auto p-2">
            <!-- 検索バー -->
            <form action="" method="get">
                <div class="row mb-3">
                    <input class="form-control col" type="text" name="search_word" placeholder="Search">
                    <button class="col-auto btn btn-light" type="submit">検索</button>
                </div>
            </form>
            <!-- 検索バー　ここまで-->
        </div>
        <!-- チェックボックス -->
        <div>
            <div class="form-check mb-2">
                <input type="checkbox" class="form-check-input" id="filter_active_votes">
                <label class="form-check-label" for="filter_active_votes">投票受付中のみ表示</label>
            </div>
            <div class="form-check mb-2">
                <input type="checkbox" class="form-check-input" id="filter_my_surveys">
                <label class="form-check-label" for="filter_my_surveys">自分のアンケートのみ表示</label>
            </div>
        </div>
        <!-- チェックボックス ここまで-->
        <div class="tags w-100 mx-auto p-3">
            {% comment %}
            {{ for タグ表示 }}
            {% endcomment %}
            <button class="btn btn-light rounded-5">{{ タグ }}</button>
            {% comment %}
            {{ endfor タグ表示 }}
            {% endcomment %}
        </div>
        <div class="surveys-list">
            <ul class="list-unstyled">       
                {% for survey in survey_list %}           
                <li>
                    <div class="card mb-3">
                        <div class="selected-tags">
                            {% comment %}
                            {{ for　タグ表示 }}
                            {% endcomment %}
                            <div class="badge bg-secondary">
                                <span>雑談</span>
                            </div>
                            {% comment %}
                            {{ endfor　タグ表示 }}
                            {% endcomment %}
                        </div>
                        
                        {# 終了：期限切れ or is_open=1（受付終了） #}
                            {% if survey.is_expired or survey.is_open == 1 %}
                                <div class="title">
                                    <h2>
                                        <span class="badge bg-secondary m-1">終</span>
                                        <a class="h2" href="{% url 'survey-detail' survey.pk %}">{{ survey.title }}</a>
                                    </h2>
                                </div>
                            {% else %}
                                {# ★作成者本人なら、受付中でも未投票でも必ず詳細へ #}
                                {% if survey.user == request.user %}
                                    <div class="title">
                                        <h2>
                                            <span class="badge bg-warning m-1">作</span>
                                            <a class="h2" href="{% url 'survey-detail' survey.pk %}">{{ survey.title }}</a>
                                        </h2>
                                    </div>
                                {% else %}
                                    {% if survey.has_voted %}
                                        {# 受付中 ＋ もう投票済み #}
                                        <div class="title">
                                            <h2>
                                                <span class="badge bg-info m-1">済</span>
                                                <a class="h2" href="{% url 'survey-detail' survey.pk %}">
                                                    {{ survey.title }}
                                                </a>
                                            </h2>
                                        </div>
                                    {% else %}
                                        {# 受付中 ＋ 未投票 → 投票作成へ #}
                                        <div class="title">
                                            <h2>
                                                <span class="badge bg-success m-1">受</span>
                                                <a class="h2" href="{% url 'vote-create' survey.pk %}">
                                                    {{ survey.title }}
                                                </a>
                                            </h2>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        <div>
                        <!-- <span>23 votes</span> --> 
                            <span>{{survey.end_at}}</span>
                        </div>
                    </div>
                    </a>
                </li>
                {%endfor%}
            </ul>
        </div>
        
        {% endblock content %}
    </div>
    <footer class="text-center p-3">
        <span class="text-muted"> &copy; Team C 2025 Autumn</span>
    </footer>
</body>

</html>